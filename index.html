<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Boggle Chaos â€” All Modes</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial;
  display: grid;
  grid-template-columns: 1fr 25vmin;
  grid-template-rows: auto 1fr auto auto;
  gap: 10px;
  overflow: hidden;
}

#board {
  grid-column: 1;
  grid-row: 2 / span 2;
  display: grid;
  gap: 10px;
  margin: auto;
}

.cell {
  border-radius: 12px;
  display: grid;
  place-items: center;
  font-weight: 800;
  user-select: none;
  cursor: pointer;
}

#controls {
  grid-column: 1;
  grid-row: 4;
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 70vmin;
  margin: auto;
}

#scoreContainer {
  display: flex;
  gap: 2rem;
  font-size: 2.8vmin;
}

#wordInput {
  width: 50%;
  font-size: 2.4vmin;
  padding: 10px 12px;
  border-radius: 10px;
  border: none;
  outline: none;
}

#wordList {
  grid-column: 2;
  grid-row: 2 / span 3;
  border: 1px solid #444;
  border-radius: 10px;
  background: #111;
  padding: 8px;
  overflow-y: auto;
  font-size: 2vmin;
}

#overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 5vmin;
  z-index: 999;
  text-align: center;
  padding: 2rem;
}

#endText {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 8vmin;
  font-weight: 900;
  color: red;
  text-align: center;
  display: none;
  z-index: 1000;
  pointer-events: none;
  line-height: 1.1;
}

label,input,button,select { font-size: 2vmin; margin: 0.3rem; }
button { padding: 0.5rem 1rem; border-radius: 8px; border:none; cursor:pointer; background:#0f0; color:#000; font-weight:bold;}
</style>
</head>
<body>

<div id="overlay">
  <div>
    <p>Customize your Boggle board!</p>
    <label>Board Size:
      <select id="boardSize">
        <option value="3">3x3</option>
        <option value="4" selected>4x4</option>
        <option value="5">5x5</option>
      </select>
    </label><br/>
    <label>Game Mode:
      <select id="gameMode">
        <option value="classic" selected>Classic</option>
        <option value="blitz">Blitz</option>
        <option value="infinite">Infinite</option>
        <option value="reverse">Reverse Boggle</option>
        <option value="category">Category Mode</option>
        <option value="length">Length Mode</option>
        <option value="suddenDeath">Sudden Death</option>
        <option value="multiplier">Multiplier Madness</option>
        <option value="timeGamble">Time Gamble</option>
        <option value="shiftingBoard">Shifting Board</option>
        <option value="rotatingDice">Rotating Dice</option>
        <option value="hiddenLetters">Hidden Letters</option>
        <option value="flash">Flash Boggle</option>
        <option value="mouseOnly">Mouse-Only</option>
        <option value="emoji">Emoji Boggle</option>
        <option value="ultraBlitz">Ultra Blitz</option>
        <option value="nightmare">Nightmare</option>
        <option value="mirror">Mirror Mode</option>
      </select>
    </label><br/>
    <label>Cell Background:
      <input type="color" id="cellBg" value="#222"/>
    </label><br/>
    <label>Cell Text:
      <input type="color" id="cellText" value="#fff"/>
    </label><br/><br/>
    <button id="startBtn">Start Game</button>
  </div>
</div>

<div id="timer">03:00</div>
<div id="debug">Loading dictionary...</div>
<div id="board"></div>

<div id="controls">
  <input id="wordInput" type="text" placeholder="Type a word and press Enter" autocomplete="off" autocapitalize="none" spellcheck="false"/>
  <div id="scoreContainer">
    <div id="score">Score: 0</div>
    <div id="highScore">High Score: 0</div>
  </div>
</div>

<div id="wordList"></div>
<div id="endText"></div>

<script src="dictionary.js"></script>
<script>
let dictionarySet = new Set(Object.keys(dictionary).map(w=>w.toLowerCase()));
document.getElementById('debug').textContent = `Dictionary loaded! Words: ${dictionarySet.size}`;

// --- Core Dice ---
let baseDice = [
  ['A','A','E','E','G','N'], ['E','L','R','T','T','Y'],
  ['A','O','O','T','T','W'], ['A','B','B','J','O','O'],
  ['E','H','R','T','V','W'], ['C','I','M','O','T','U'],
  ['D','I','S','T','T','Y'], ['E','I','O','S','S','T'],
  ['D','E','L','R','V','Y'], ['A','C','H','O','P','S'],
  ['H','I','M','N','Qu','U'], ['E','E','I','N','S','U'],
  ['E','E','G','H','N','W'], ['A','F','F','K','P','S'],
  ['H','L','N','N','R','Z'], ['D','E','I','L','R','X']
];

let timerSeconds = 180;
let timerInterval = null;
let spinInterval = null;
let totalScore = 0;
let highScore = localStorage.getItem('boggleHighScore') ? parseInt(localStorage.getItem('boggleHighScore')) : 0;
let foundWords = new Set();
let cellBgColor = '#222';
let cellTextColor = '#fff';
let currentBoard = [];
let tapWord = "";
let autoSubmitTimeout = null;
let currentPath = [];
let currentMode = 'classic';
let boardSize = 4;

// --- HELPER FUNCTIONS ---
function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function pad(n){ return String(n).padStart(2,'0'); }
function resetAutoSubmit(){ if(autoSubmitTimeout) clearTimeout(autoSubmitTimeout); autoSubmitTimeout = setTimeout(autoSubmitWord, 750); }
function getRandomColor(){ const r=Math.floor(Math.random()*256); const g=Math.floor(Math.random()*256); const b=Math.floor(Math.random()*256); return `rgb(${r},${g},${b})`; }

// --- BOARD CREATION ---
function createBoard(){
  const boardDiv = document.getElementById('board');
  boardDiv.innerHTML='';
  boardDiv.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;
  boardDiv.style.gridTemplateRows = `repeat(${boardSize}, 1fr)`;
  currentBoard = [];
  let dice = [...baseDice];
  // add/remove dice if board size changes
  if(boardSize!==4){
    while(dice.length < boardSize*boardSize) dice.push(['A','E','I','O','U','Y']);
    dice = dice.slice(0, boardSize*boardSize);
  }
  const shuffledDice = shuffle(dice);
  for(let i=0;i<boardSize;i++){
    let row=[];
    for(let j=0;j<boardSize;j++){
      const index = i*boardSize + j;
      const letters = shuffledDice[index];
      let chosen = letters[Math.floor(Math.random()*letters.length)];
      if(currentMode==='emoji'){ // convert letters to emoji for fun
        const emojiMap = {'A':'ðŸŽ','B':'ðŸŒ','C':'ðŸ¥•','D':'ðŸ¶','E':'ðŸ¥š','F':'ðŸ¸','G':'ðŸ‡','H':'ðŸ ','I':'ðŸ¦','J':'ðŸ§ƒ','K':'ðŸ”‘','L':'ðŸ¦','M':'ðŸŒ','N':'ðŸ¥œ','O':'ðŸŠ','P':'ðŸ¥ž','Q':'ðŸ‘‘','R':'ðŸŒˆ','S':'ðŸ','T':'ðŸŒ®','U':'â˜‚ï¸','V':'ðŸŒ‹','W':'ðŸ‰','X':'âŒ','Y':'ðŸª€','Z':'âš¡'}; 
        chosen = emojiMap[chosen.toUpperCase()] || chosen;
      }
      const cell = document.createElement('div');
      cell.className='cell';
      cell.textContent = chosen;
      cell.style.background = cellBgColor;
      cell.style.color = cellTextColor;
      // clicking letters
      cell.addEventListener('click', ()=>{
        if(currentMode==='mouseOnly'){} // disable typing
        if(currentPath.length>0){
          const last = currentPath[currentPath.length-1];
          const dr = Math.abs(i-last[0]);
          const dc = Math.abs(j-last[1]);
          if(dr>1 || dc>1) return;
        }
        for(const p of currentPath){ if(p[0]===i && p[1]===j) return; }
        currentPath.push([i,j]);
        tapWord += chosen.toLowerCase();
        resetAutoSubmit();
      });
      boardDiv.appendChild(cell);
      row.push(chosen.toLowerCase());
    }
    currentBoard.push(row);
  }
}

// --- WORD SUBMISSION ---
function autoSubmitWord(){
  const word = tapWord.trim().toLowerCase();
  if(word && !foundWords.has(word) && dictionarySet.has(word) && isWordOnBoard(word)){
    foundWords.add(word);
    let points = Math.max(word.length-2,0);
    // Multiplier Madness mode
    if(currentMode==='multiplier') points *= 2;
    updateScore(points);
    const li = document.createElement('div');
    li.textContent = word;
    document.getElementById('wordList').appendChild(li);
  }else if(currentMode==='suddenDeath' && word) gameOver();
  tapWord='';
  currentPath=[];
}

// --- TIMER ---
function startTimer(){
  clearInterval(timerInterval);
  if(currentMode==='blitz') timerSeconds=60;
  else if(currentMode==='ultraBlitz') timerSeconds=30;
  else if(currentMode==='infinite') timerSeconds=9999;
  else timerSeconds=180;

  document.getElementById('timer').textContent = `${pad(Math.floor(timerSeconds/60))}:${pad(timerSeconds%60)}`;
  timerInterval = setInterval(()=>{
    timerSeconds--;
    const m = Math.floor(timerSeconds/60), s = timerSeconds%60;
    document.getElementById('timer').textContent = `${pad(m)}:${pad(s)}`;
    if(timerSeconds <= 0 && currentMode!=='infinite'){
      clearInterval(timerInterval);
      gameOver();
    }
  },1000);
}

// --- GAME OVER ---
function gameOver(){
  clearInterval(timerInterval);
  stopSpin();
  const t = document.getElementById('endText');
  t.textContent = 'BOGGLE DONE!';
  t.style.display='block';
  let angle = 0;
  spinInterval = setInterval(()=>{ angle = (angle+5)%360; t.style.transform=`translate(-50%,-50%) rotate(${angle}deg)` },50);

  const scoreText = document.createElement('div');
  scoreText.style.fontSize = '5vmin';
  scoreText.style.color = 'yellow';
  scoreText.style.marginTop='1rem';
  scoreText.innerHTML = `Your Score: ${totalScore}<br/>High Score: ${highScore}`;
  t.appendChild(scoreText);

  if(totalScore>highScore){ highScore=totalScore; localStorage.setItem('boggleHighScore',highScore); scoreText.innerHTML += '<br/>New High Score! ðŸŽ‰'; document.getElementById('highScore').textContent=`High Score: ${highScore} ðŸŽ‰`; }

  const flashDuration = 5140;
  const flashIntervalTime = 50;
  let elapsed=0;
  const flashInterval = setInterval(()=>{
    document.body.style.background=getRandomColor();
    document.body.style.color=getRandomColor();
    elapsed+=flashIntervalTime;
    if(elapsed>=flashDuration){ clearInterval(flashInterval); document.body.style.background='#000'; document.body.style.color='#fff'; }
  }, flashIntervalTime);
}

function stopSpin(){ if(spinInterval){ clearInterval(spinInterval); spinInterval=null; } }

// --- WORD CHECK ---
function isWordOnBoard(word){
  const visited = Array(boardSize).fill(null).map(()=>Array(boardSize).fill(false));
  function dfs(r,c,index){
    if(index===word.length) return true;
    if(r<0||r>=boardSize||c<0||c>=boardSize) return false;
    if(visited[r][c]) return false;
    if(currentBoard[r][c] !== word[index]) return false;
    visited[r][c]=true;
    for(let dr=-1;dr<=1;dr++){
      for(let dc=-1;dc<=1;dc++){
        if(dr!==0||dc!==0){
          if(dfs(r+dr,c+dc,index+1)) return true;
        }
      }
    }
    visited[r][c]=false;
    return false;
  }
  for(let r=0;r<boardSize;r++){ for(let c=0;c<boardSize;c++){ if(dfs(r,c,0)) return true; } }
  return false;
}

// --- SCORE ---
function updateScore(points){
  totalScore += points;
  document.getElementById('score').textContent=`Score: ${totalScore}`;
  if(totalScore>highScore){ highScore=totalScore; localStorage.setItem('boggleHighScore',highScore); document.getElementById('highScore').textContent=`High Score: ${highScore} ðŸŽ‰`; }
}

// --- INPUT ---
const wordInput = document.getElementById('wordInput');
wordInput.addEventListener('keydown', e=>{
  if(currentMode==='mouseOnly') return;
  if(e.key==='Enter'){
    const word = wordInput.value.trim().toLowerCase();
    if(word && !foundWords.has(word) && dictionarySet.has(word) && isWordOnBoard(word)){
      foundWords.add(word);
      let points = Math.max(word.length-2,0);
      if(currentMode==='multiplier') points*=2;
      updateScore(points);
      const li = document.createElement('div');
      li.textContent = word;
      document.getElementById('wordList').appendChild(li);
    }else if(currentMode==='suddenDeath' && word) gameOver();
    wordInput.value='';
  }
});

// --- START GAME ---
document.getElementById('startBtn').addEventListener('click', ()=>{
  cellBgColor = document.getElementById('cellBg').value;
  cellTextColor = document.getElementById('cellText').value;
  currentMode = document.getElementById('gameMode').value;
  boardSize = parseInt(document.getElementById('boardSize').value);
  document.getElementById('overlay').style.display='none';
  totalScore=0; foundWords.clear(); document.getElementById('wordList').innerHTML=''; document.getElementById('score').textContent=`Score: 0`;
  tapWord=''; currentPath=[];
  createBoard();
  startTimer();
});

// --- RESET ON SPACE ---
document.addEventListener('keydown', e=>{
  if(e.code==='Space'){
    document.getElementById('endText').style.display='none';
    document.getElementById('endText').innerHTML=''; 
    totalScore=0; foundWords.clear(); document.getElementById('wordList').innerHTML=''; document.getElementById('score').textContent=`Score: 0`;
    tapWord=''; currentPath=[];
    createBoard();
    startTimer();
  }
});
</script>
</body>
</html>
